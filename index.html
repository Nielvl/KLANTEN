<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klantenbeheer voor Heftruckchauffeur</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8LJ0Q0Se0O8Q38FPvC31zxIj8i05q35M"></script>
    <style>
        .hidden { display: none; }
        .klant-kader {
            border: 1px solid #ccc; 
            border-radius: 8px; 
            padding: 16px;
            margin-bottom: 16px;
        }
        .details-button, .mail-button, .photo-button {
            padding: 8px 16px;
            background-color: #007BFF; 
            color: white; 
            border: none; 
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .details-button:hover, .mail-button:hover, .photo-button:hover {
            background-color: #0056b3;
        }
        .back-button {
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: #218838;
        }
        .klant-details {
            display: flex;
            flex-wrap: wrap;
        }
        .klant-info {
            flex: 1 1 50%;
            padding-right: 20px;
        }
        #map {
            height: 400px;
            width: 100%;
        }
        @media (max-width: 768px) {
            .klant-info {
                flex: 1 1 100%;
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl m-3">
        <div class="p-8">
            <h1 class="text-2xl font-bold mb-4">Klantenbeheer voor Heftruckchauffeur</h1>
            
            <input type="text" id="klant-zoek" placeholder="Search a client..." class="w-full p-2 mb-8 border rounded">
            <div class="flex justify-between mb-8">
                <button id="sort-button" class="details-button">Sort Alphabetic</button>
                <button id="sort-time-button" class="details-button">Sort by Time</button>
                <button id="original-button" class="details-button hidden">Original sorting</button>
            </div>
            <ul id="klant-lijst" class="mb-8 max-h-96 overflow-y-auto"></ul>

            <div id="klant-info-container" class="hidden klant-details">
                <div id="klant-info" class="klant-info">
                    <button id="back-button" class="back-button mb-8">Terug naar klantenlijst</button>
                    <h2 id="klant-naam" class="text-xl font-semibold mb-2"></h2>
                    <p id="klant-voorkeuren" class="mb-2"></p>
                    <div id="map" class="mb-4"></div>
                    <div id="photo-buttons" class="mb-4"></div>
                </div>
                <div id="photo-container" class="hidden w-full">
                    <img id="klant-voertuig" src="" alt="Voertuig van de klant" class="mb-4 max-w-full h-auto">
                </div>
            </div>
        </div>
    </div>

    <script>
        let klantData = {};
        let origineleVolgorde = [];

        // Klantgegevens laden vanuit een extern JSON-bestand
        fetch('klantData.json')
            .then(response => response.json())
            .then(data => {
                klantData = data;
                origineleVolgorde = Object.keys(klantData);
                toonKlanten(); // Toon de klanten zodra de data is geladen
            })
            .catch(error => console.error('Error loading customer data:', error));

        const zoekInput = document.getElementById('klant-zoek');
        const klantLijst = document.getElementById('klant-lijst');
        const klantInfoContainer = document.getElementById('klant-info-container');
        const klantInfo = document.getElementById('klant-info');
        const backButton = document.getElementById('back-button');
        const sortButton = document.getElementById('sort-button');
        const sortTimeButton = document.getElementById('sort-time-button');
        const originalButton = document.getElementById('original-button');
        const photoContainer = document.getElementById('photo-container');
        const photoButtons = document.getElementById('photo-buttons');

        // Klantenlijst tonen
        function toonKlanten(filter = '', sorteer = false, sorteerOpTijd = false) {
            klantLijst.innerHTML = '';
            let klantenNamen = Object.keys(klantData).filter(naam => naam.toLowerCase().includes(filter.toLowerCase()));
            if (sorteer) {
                klantenNamen.sort();
            } else if (sorteerOpTijd) {
                klantenNamen.sort((a, b) => {
                    const timeA = a.split(' ').pop();
                    const timeB = b.split(' ').pop();
                    return timeA.localeCompare(timeB);
                });
            } else {
                klantenNamen = origineleVolgorde.filter(naam => naam.toLowerCase().includes(filter.toLowerCase()));
            }
            klantenNamen.forEach(naam => {
                const li = document.createElement('li');
                li.className = 'klant-kader';

                // Voeg de klantnaam en tijdsindicatie toe
                const klantNaamEnTijd = document.createElement('div');
                klantNaamEnTijd.className = 'mb-4';
                const naamDelen = naam.split(' ');
                const tijd = naamDelen.pop();
                const klantNaam = naamDelen.join(' ');
                klantNaamEnTijd.innerHTML = `<span class="font-semibold text-lg">${klantNaam}</span><br><span class="text-sm text-gray-500">${tijd}</span>`;
                li.appendChild(klantNaamEnTijd);

                // Voeg de knoppen toe
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'flex justify-between items-center';
                
                const detailsButton = document.createElement('button');
                detailsButton.textContent = 'See Details';
                detailsButton.className = 'details-button flex-grow mr-2';
                detailsButton.onclick = () => toonKlantInfo(naam);
                buttonContainer.appendChild(detailsButton);

                const mailButton = document.createElement('button');
                mailButton.textContent = 'Send Mail';
                mailButton.className = 'mail-button flex-grow';
                mailButton.onclick = () => sendMail(naam);
                buttonContainer.appendChild(mailButton);

                li.appendChild(buttonContainer);

                klantLijst.appendChild(li);
            });
        }

        // Klantinformatie tonen wanneer op "See Details" wordt geklikt
        function toonKlantInfo(naam) {
            const klant = klantData[naam];
            document.getElementById('klant-naam').textContent = naam;
            document.getElementById('klant-voorkeuren').textContent = `Voorkeuren: ${klant.Voorkeuren || klant.voorkeuren}`;
            
            klantInfoContainer.classList.remove('hidden');
            klantLijst.classList.add('hidden');
            zoekInput.classList.add('hidden');
            backButton.classList.remove('hidden');

            // Google Maps initialiseren
            const [lat, lng] = klant.locatie.split(', ').map(parseFloat);
            const map = new google.maps.Map(document.getElementById('map'), {
                center: { lat, lng },
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.SATELLITE
            });
            new google.maps.Marker({ position: { lat, lng }, map: map });

            // Foto knoppen toevoegen
            photoButtons.innerHTML = '';
            photoContainer.classList.add('hidden');
            const photos = [
                { key: 'voertuigFoto', label: 'Foto 1' },
                { key: 'voertuigFoto1', label: 'Foto 2' },
                { key: 'voertuigFoto2', label: 'Foto 3' }
            ];

            photos.forEach(photo => {
                if (klant[photo.key]) {
                    const button = document.createElement('button');
                    button.textContent = photo.label;
                    button.className = 'photo-button mr-2 mb-2';
                    button.onclick = () => toonFoto(klant[photo.key]);
                    photoButtons.appendChild(button);
                }
            });
        }

        // Foto tonen
        function toonFoto(url) {
            const img = document.getElementById('klant-voertuig');
            img.src = url;
            photoContainer.classList.remove('hidden');
        }

        // E-mail versturen
        function sendMail(naam) {
            const subject = encodeURIComponent(`Klant ${naam} is afgeleverd`);
            const body = encodeURIComponent(`De klant ${naam} is afgeleverd.`);
            window.location.href = `mailto:sales@vanlaethem.eu?subject=${subject}&body=${body}`;
        }

        // Terug naar de klantenlijst
        backButton.onclick = () => {
            klantInfoContainer.classList.add('hidden');
            klantLijst.classList.remove('hidden');
            zoekInput.classList.remove('hidden');
            backButton.classList.add('hidden');
            photoContainer.classList.add('hidden');
        };

        zoekInput.addEventListener('input', (e) => toonKlanten(e.target.value));

        sortButton.onclick = () => {
            toonKlanten(zoekInput.value, true);
            sortButton.classList.add('hidden');
            sortTimeButton.classList.add('hidden');
            originalButton.classList.remove('hidden');
        };

        sortTimeButton.onclick = () => {
            toonKlanten(zoekInput.value, false, true);
            sortButton.classList.add('hidden');
            sortTimeButton.classList.add('hidden');
            originalButton.classList.remove('hidden');
        };

        originalButton.onclick = () => {
            toonKlanten(zoekInput.value);
            originalButton.classList.add('hidden');
            sortButton.classList.remove('hidden');
            sortTimeButton.classList.remove('hidden');
        };
    </script>
</body>
</html>